#!/bin/sh
#
# Pre-commit hook that runs cargo fmt on all Rust files
#

# Check if cargo is available
if ! command -v cargo >/dev/null 2>&1; then
    echo "Error: cargo is not installed or not in PATH"
    exit 1
fi

echo "Running cargo fmt..."

# Run cargo fmt and capture if it made any changes
cargo fmt --all --check 2>/dev/null
fmt_status=$?

if [ $fmt_status -ne 0 ]; then
    echo "Formatting code with cargo fmt..."
    cargo fmt --all
    
    # Check if any files were modified
    if ! git diff --quiet; then
        echo ""
        echo "cargo fmt has formatted your code. The formatted files have been staged."
        echo "Please review the changes."
        
        # Stage the formatted files
        git add -u
    fi
fi

echo "Pre-commit checks passed!"
exit 0